# Create a view to find object records that need replacing
CREATE OR REPLACE VIEW object_image_relinking AS
    SELECT
        original_object.object_id AS original_object_id,
        reimported_object.object_id AS new_object_id,
        original_object.idno AS original_idno,
        original_object.deleted AS original_deleted,
        original_representation.original_filename AS original_original_filename,
        oxr.representation_id AS original_representation_id,
        reimported_representation.original_filename AS reimported_original_filename,
        roxr.representation_id AS new_representation_id
    FROM ca_objects original_object
        JOIN ca_objects_x_object_representations oxr ON original_object.object_id = oxr.object_id
        JOIN ca_object_representations original_representation ON oxr.representation_id = original_representation.representation_id
        LEFT JOIN ca_objects reimported_object ON (
            # Match records on type and idno
            # to find records that have been re-imported
            original_object.idno = reimported_object.idno AND
            original_object.type_id = reimported_object.type_id AND
            original_object.object_id <> reimported_object.object_id
            )
        LEFT JOIN ca_objects_x_object_representations roxr ON reimported_object.object_id = roxr.object_id
        LEFT JOIN ca_object_representations reimported_representation ON roxr.representation_id = reimported_representation.representation_id
    WHERE original_object.idno IN(
        'A1900.188', 'A1900.230', 'A1900.41', 'A1991.108', 'P1999.1353copied', 'P1999.1627copied', 'P1999.1636copied', 'P1999.1644copied', 'P1999.1645', 'P1999.1646copied', 'P1999.1647copied', 'P1999.1648copied', 'P1999.1649copied', 'P1999.1650copied', 'P1999.1682copied', 'P1999.1760copied', 'P1999.1815copied', 'MA1984.378', 'P1995.31d', 'P1999.6792', 'P1999.3030', 'P1999.3038', 'P1999.3048', 'P1999.3059', 'P1999.6849', 'P2004.183a', 'P1999.7071', 'P1999.7306', 'P1999.7307', 'P2007.89FP', 'P2007.138FP', 'P2007.151FP', 'P2007.156FP', 'P1999.801', 'P2009.345', 'P2009.533', 'P2010.22fp', 'P1999.4847', 'P1999.2300', 'P2010.360', 'P2010.360a', 'P2010.359', 'P2010.358', 'P2010.357', 'P2010.356', 'P2010.355', 'P2010.354', 'P2010.349', 'P2010.352', 'P2012.3007', 'P1999.3041', 'P2012.1826', 'P2013.2041', 'P2013.2042', 'P2013.2043', 'P2013.2044', 'P2013.2045', 'P2013.2046', 'P2013.2047', 'P2013.2048', 'P2013.2049', 'P2013.2050', 'P2013.2051', 'P2013.2052', 'P2013.2053', 'P2013.2054', 'P2013.2056', 'P2013.2055', 'P2013.2057', 'P2013.2058', 'P2013.2059', 'P2013.2060', 'P2013.2061', 'P2013.2062', 'P2013.2063', 'P2013.2064', 'P2013.2065', 'P2013.2066', 'P2013.2067', 'P2013.2068', 'P2013.2069', 'P2013.2070', 'P2013.2071', 'P2013.2072', 'P2013.2073', 'P1999.2474Copied', 'P1999.2694Copied', 'P1999.2695Copied', 'P1999.2697copied', 'P1999.2700Copied', 'P1999.2703copied', 'P1999.2710copied', 'P2013.2074', 'P2013.2075', 'P2013.2076', 'P2013.2077', 'P2013.2087', 'P2013.2088', 'P2013.2089', 'P2013.2090', 'P2013.2091', 'P2013.2092', 'P2013.2093', 'P2013.2094', 'P2013.2095', 'P2013.2096', 'P2013.2097', 'P2013.2098', 'P2013.2099', 'P2013.2100', 'P2013.2101', 'P2013.2102', 'P1999.2711copied', 'P1999.2721copied', 'P2013.2103', 'P2013.2104', 'P1999.2719copied', 'P1999.2722copied', 'P2013.2723copied', 'P2013.2105', 'P2013.2106', 'P2013.2107', 'P2013.2108', 'P2013.2109', 'P2013.2110', 'P2013.2112', 'P2013.2111', 'P2013.2113', 'P2013.2114', 'P2013.2115', 'P2013.2116', 'P2013.2117', 'P2013.2118', 'P1999.1023pg1', 'P1999.1023pg2', 'P1999.1023pg7', 'P1999.1023pg8', 'P1999.1023pg13', 'P1999.1023pg14', 'P1999.1023pg19', 'P1999.1023pg20', 'P1999.1023pg25', 'P1999.1023pg26', 'P1999.1023pg27', 'P1999.1023pg32', 'P1999.1023pg33', 'P1999.1023pg34', 'P1999.1023pg35', 'P1999.4309', 'P1999.4311', 'P1999.3997copied', 'P1999.4013copied', 'P2013.2119', 'P2013.2120', 'P1999.4014copied', 'P1999.6814copied', 'P1999.6815copied', 'P1999.6807copied', 'P1999.6802copied', 'P1999.6796copied', 'P1999.6799copied', 'P2013.2121', 'P2013.2123', 'P2013.2122', 'P2013.2124', 'P2013.2125', 'P2013.2126', 'P2013.2127', 'P2013.2128', 'P2013.2129', 'P2013.2130', 'P2013.2131', 'P2013.2132', 'P2013.2133', 'P2013.2134', 'P2013.2135', 'P2013.2136', 'P2013.2137', 'P2013.2138', 'P2013.2139', 'P2013.2140', 'P2013.2141', 'P2013.2142', 'P1999.6795copied', 'P1999.631', 'P1999.6794copied', 'P2013.2143', 'P2013.2144', 'P2013.2145', 'P2013.2146', 'P2013.2147', 'P1999.632', 'P1999.4366', 'P2013.2148', 'P2013.2149', 'P2013.2150', 'P2013.2151', 'P2013.2152', 'P2013.2153', 'P2013.2154', 'P2013.2155', 'P2013.2156', 'P2013.2157', 'P2013.2158', 'P2013.2159', 'P2013.2160', 'P1999.6800', 'P2013.2161', 'P1999.6801', 'P2013.2162', 'P2013.2163', 'P2013.2164', 'P2013.2165', 'P2013.3486copied', 'P2013.2166', 'P2013.2167', 'P2013.2168', 'P1999.3474copied', 'P2013.2169', 'P1999.3483copied', 'P1999.637copied', 'P1999.4308', 'P2013.2335', 'P2013.2334', 'P2013.2333', 'P2013.2332', 'P2013.2331', 'P2013.2330', 'P2013.2329', 'P2013.2328', 'P2013.2327', 'P1999.638', 'P1999.1079copied', 'P1999.1048', 'P1999.1049', 'P1999.1050', 'P1999.1012a', 'P1999.636', 'P2013.2170', 'P2013.2171', 'P2013.2172', 'P2013.2173', 'P2013.2174', 'P2013.2175', 'P2013.2176', 'P2013.2177', 'P2013.2178', 'P2013.2179', 'P2013.2180', 'P2013.2181', 'P2013.2182', 'P2013.2183', 'P2014.2184', 'P2013.2185', 'P2013.2186', 'P2013.2187', 'P2013.2188', 'P2013.2189', 'P2013.2190', 'P2013.2191', 'P2013.2192', 'P2013.2193', 'P2013.2194', 'P2013.2195', 'P2013.2196', 'P2013.2197', 'P2013.2198', 'P2013.2199', 'P2013.2200', 'P2013.2201', 'P2013.2202', 'P2013.2203', 'P2013.2204', 'P2013.2205', 'P2013.2206', 'P2013.2207', 'P2013.2208', 'P2013.2209', 'P2013.2210', 'P2013.2211', 'P2013.2212', 'P2013.2213', 'P2013.2214', 'P2013.2215', 'P2013.2216', 'P2013.2217', 'P2013.2218', 'P2013.2219', 'P2013.2220', 'P2013.2221', 'P2013.2222', 'P2013.2223', 'P2013.2224', 'P2013.2225', 'P2013.2226', 'P2013.2227', 'P2013.2228', 'P2013.2229', 'P2013.2230', 'P2013.2231', 'P2013.2232', 'P2013.2233', 'P2013.2234', 'P2013.2235', 'P2013.2236', 'P2013.2237', 'P2013.2238', 'P2013.2239', 'P2013.2240', 'P2013.2241', 'P2013.2242', 'P2013.2243', 'P2013.2244', 'P2013.2245', 'P2013.2246', 'P2013.2247', 'P2013.2248', 'P2013.2249', 'P2013.2250', 'P2013.2251', 'P2013.2252', 'P2013.2253', 'P2013.2254', 'P2013.2255', 'P2013.2256', 'P2013.2257', 'P2013.2258', 'P2013.2259', 'P2013.2260', 'P2013.2261', 'P2014.122', 'P2013.2262', 'P2013.2263', 'P2013.2264', 'P2013.2265', 'P2013.2266', 'P2013.2267', 'P2013.2268', 'P2013.2269', 'P2013.2270', 'P2013.2271', 'P2013.2272', 'P2013.2273', 'P2013.2274', 'P2013.2275', 'P2013.2276', 'P2013.2277', 'P2013.2278', 'P2013.2279', 'P2013.2280', 'P2013.2281', 'P2013.2282', 'P2013.2283', 'P2013.2284', 'P2013.2285', 'P2013.2286', 'P2013.2287', 'P2013.2288', 'P2013.2289', 'P2013.2290', 'P2013.2291', 'P2013.2292', 'P2013.2293', 'P2013.2294', 'P2013.2295', 'P2013.2296', 'P2013.2297', 'P2013.2298', 'P2013.2299', 'P2013.2300', 'P2013.2301', 'P2013.2302', 'P2013.2303', 'P2013.2304', 'P2013.2305', 'P2013.2306', 'P2013.2307', 'P2013.2308', 'P2013.2309', 'P2013.2310', 'P2013.2311', 'P2013.2312', 'P2013.2313', 'P2013.2314', 'P2013.2315', 'P2013.2316', 'P2013.2317', 'P2013.2318', 'P2013.2319', 'P2013.2320', 'P2013.2321', 'P2013.2322', 'P2014.2323', 'P2013.2324', 'P2013.2325', 'P2014.539', 'P2014.617', 'P2014.618', 'P2014.619', 'P2014.620', 'P2014.621', 'P2014.622', 'P2014.616', 'P1999.1012', 'P2014.607', 'P2014.608', 'P2014.609', 'P2014.610', 'P2014.611', 'P2014.612', 'P2014.613', 'P2014.614', 'P2014.615', 'MA1900.294A-C', 'P2015.2184', 'P2015.518', 'P2015.900', 'P2015.901', 'P2015.902', 'P2015.903', 'P2015.904', 'P2015.905', 'P2015.906', 'P2015.907', 'P2015.908', 'P2015.909', 'P2015.910', 'P2015.911', 'P2015.912', 'P2015.913', 'P2015.914', 'P2015.987', '2000.0', 'A2007.94', 'A2009.129a-b', 'MA2014.50', 'P1999.5367copied', 'P1999.6779', 'P1999.854', 'P2003.809', 'P2007.113FP', 'P2014.822', 'T1935.17a', 'T1937.44', 'T1940.18b', 'T1944.7', 'T1951.10', 'T1962.72', 'T1963.80d', 'T1974.47', 'T1975.57', 'T1977.49a-c', 'T1978.79', 'T1979.123', 'T1979.127', 'T1979.231a', 'T1979.231b', 'T1979.232', 'T1979.237', 'T1979.69', 'T1979.88a', 'T1979.88b', 'T1980.138e', 'T1980.172a', 'T1980.172b', 'T1980.69', 'T1980.70d', 'T1980.71', 'T1981.190c', 'T1982.58b', 'T1982.58C', 'T1982.58D', 'T1982.58E', 'T1982.74a,b', 'T1982.74c', 'T1983.26', 'T1985.124', 'T1985.195', 'T1986.193', 'T1986.194', 'T1986.195', 'T1987.201', 'T1987.222A', 'T1987.222B', 'T1988.156', 'T1988.164', 'T1988.167P', 'T1988.167Q', 'T1988.167R', 'T1988.58D', 'T1989.120', 'T1990.131', 'T1990.61a', 'T1990.61b', 'T1990.98', 'T1991.10a', 'T1991.10b', 'T1991.10d', 'T1991.59', 'T1991.71', 'T1991.8', 'T1991.8a', 'T1992.119', 'T1992.82h', 'T1993.13', 'T1993.18', 'T1993.21', 'T1993.22', 'T1994.66', 'T1994.98', 'T1997.32a-b', 'T1997.59', 'T1997.7a', 'T1997.7b', 'T1997.7c', 'T1998.65', 'T1999.8', 'T2007.175', 'T2011.57', 'T2012.5', 'T2012.53', 'T2013.2'
    )
        AND(
              original_object.deleted OR
              reimported_object.object_id IS NULL
          )
    ORDER BY original_object.idno_sort;

DROP VIEW IF EXISTS object_image_relinking;
